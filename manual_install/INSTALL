1. Build a Virtual Machine with the CloudFoundry VM registered in your cloud.

2. Create a file for your OpenStack credentials (these will be used by fog)
  $ cat > ~/.fog
  :default: 
    :openstack_auth_url: YOUR OPENSTACK CLOUD AUTH URL
    :openstack_username: YOUR USERNAME
    :openstack_api_key: YOUR PASSWORD
    :openstack_tenant: YOUR TENANT OR PROJECT NAME

2. Create a deployment keypair
  $ ~/generate_keypair <name>
  #
  # If name is unspecified a random name will be generated 
  #   e.g. bosh-fa7deff0

3. Configure your initial bosh installation
  
  $ ~/bosh_config <key_name>
  # The keyname refers to the keypair generated in the previous step.
     
4. Build the release, this step will take a while.
  $ cd /var/vcap/releases/bosh-release
  $ bosh --non-interactive create release --with-tarball

5. Generate the stemcell, this step will take a while.
  $ cd /var/vcap/bootstrap/bosh/agent
  $ rake stemcell2:micro["openstack",/var/vcap/manifests/openstack_micro.yml,/var/vcap/releases/bosh-release/dev_releases/bosh-7.1-dev.tgz]

  # This will result in a message saying:
  # Generated stemcell: /var/tmp/bosh/agent-x.y.z-PID/work/work/micro-bosh-stemcell-openstack-x.y.z.tgz .
  # copy the stemcell to a good location
  $ cp <that path> /var/vcap/stemcells

6. Deploy it.
  $ cd /var/vcap/deployments
  $ bosh micro deployment microbosh-openstack
  $ bosh micro deploy

7. Target the new bosh director
  $ bosh target <ip>

  # You will be prompted for credentials by default they're admin:admin
  # you can change this in your /var/vcap/deployments/microbosh-openstack/micro_bosh.yml 
  # deployment manifest.


Cloud Foundry

1. Provision five floating IP addresses for your cloudfoundry installation.
2. Prepare the configuration.
   $ mkdir -p /var/vcap/deployments/cloudfoundry

   # Get UUID and IP of Bosh Director
   $ bosh status  # You'll need the IP address of the bosh host and the UUID.

   # Get the salted password from the bosh config.
   $ cat var/vcap/deployments/microbosh-openstack/micro_bosh.yml | grep password
   #   => $6$123457890$LONGSTRINGLONGSTRINGLONGSTRING

   $ cp ~/cloudfoundry.yml /var/vcap/deployments/cloudfoundry/cloudfoundry.yml
   $ vi /var/vcap/deployments/cloudfoundry/cloudfoundry.yml
   # You'll need to update the floating addresses for the jobs and their properties.

3. Deploy
  $ cd /var/vcap/deployments
  $ bosh deployment cloudfoundry/cloudfoundry.yml
  $ bosh deploy
